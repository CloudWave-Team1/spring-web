<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Messages</title>
    <style>
        /* 테이블에 테두리 추가 */
        table {
            border-collapse: collapse;  /* 테두리가 겹치도록 설정 */
            width: 100%;
        }

        /* 테이블의 셀마다 테두리 추가 */
        table, th, td {
            border: 1px solid black;
        }

        th, td {
            padding: 10px;  /* 셀 내부의 패딩 추가 */
        }

        .hidden-receiptHandle {
            display: none;
        }
    </style>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById('checkBoxForm').addEventListener('submit', function(e) {
                e.preventDefault();  // 폼의 기본 제출 동작을 중지합니다.
                const checkboxes = document.querySelectorAll('.orderCheckbox');
                let selectedValues = [];

                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        selectedValues.push(checkbox.value);
                    }
                });

                // 선택된 체크박스가 없으면 알림을 보여줍니다.
                if (selectedValues.length === 0) {
                    alert('Please select at least one checkbox.');
                    return;
                }

                // 선택된 각 체크박스에 대해 AJAX 요청을 전송합니다.
                selectedValues.forEach(receiptHandle => {
                    const data = {
                        receiptHandle: receiptHandle
                    };

                    fetch('/api/messages/complete', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    }).then(response => {
                        if (response.status === 200) {
                            alert('Message deleted successfully');
                        } else {
                            alert('Error occurred');
                        }
                    });
                });
            });
        });
    </script>

</head>
<body>

<h2>Message List</h2>

<form id="checkBoxForm" action="/yourControllerPath" method="post">
    <table>
        <thead>
        <tr>
            <th>Select</th>
            <th>Order ID</th>
            <th>Food Item</th>
            <th>Quantity</th>
            <th>Order Date</th>
            <th class="hidden-receiptHandle" >receiptHandle</th>
<!--            <th class="hidden-receiptHandle" >phoneNumber</th>-->
        </tr>
        </thead>
        <tbody>
        <tr th:each="order : ${orders}">
            <td><input type="checkbox" class="orderCheckbox" th:value="${order.receiptHandle}" name="receiptHandles"/></td>
            <td th:text="${order.orderId}"></td>
            <td th:text="${order.foodItem}"></td>
            <td th:text="${order.quantity}"></td>
            <td th:text="${order.orderDate}"></td>
            <td class="hidden-receiptHandle" th:text="${order.receiptHandle}"></td>
<!--            <td class="hidden-receiptHandle" th:text="${order.phoneNumber}"></td>-->
        </tr>
        </tbody>
    </table>
    <button type="submit">Submit Selected</button>
</form>

</body>
</html>